#ifndef KEYBOARD_H
#define KEYBOARD_H

#include "types.h"


#define KB_RIGHT_SHIFT_PRESSED 0x1
#define KB_LEFT_SHIFT_PRESSED 0x2
#define KB_CTRL_PRESSED 0x4
#define KB_ALT_PRESSED 0x8
#define KB_SCROLLOCK_ACTIVE 0x10
#define KB_NUMLOCK_ACTIVE 0x20
#define KB_CAPSLOCK_ACTIVE 0x40
#define KB_INSERT_ACTIVE 0x80

#define KB_LEFT_CTRL_PRESSED 0x1
#define KB_LEFT_ALT_PRESSED 0x2
#define KB_RIGHT_CTRL_PRESSED 0x4
#define KB_RIGHT_ALT_PRESSED 0x8
#define KB_SCROLLLOCK_PRESSED 0x10
#define KB_NUMLOCK_PRESSED 0x20
#define KB_CAPSLOCK_PRESSED 0x40
#define KB_SYSREQ_PRESSED 0x80

enum kb_scancodes_set1 {
  KB1_SC_ESC = 0x01,
  KB1_SC_1 = 0x02,
  KB1_SC_2 = 0x03,
  KB1_SC_3 = 0x04,
  KB1_SC_4 = 0x05,
  KB1_SC_5 = 0x06,
  KB1_SC_6 = 0x07,
  KB1_SC_7 = 0x08,
  KB1_SC_8 = 0x09,
  KB1_SC_9 = 0x0A,
  KB1_SC_0 = 0x0B,
  KB1_SC_MINUS = 0x0C,
  KB1_SC_EQUALS = 0x0D,
  KB1_SC_BACKSPACE = 0x0E,
  KB1_SC_TAB = 0x0F,
  KB1_SC_Q = 0x10,
  KB1_SC_W = 0x11,
  KB1_SC_E = 0x12,
  KB1_SC_R = 0x13,
  KB1_SC_T = 0x14,
  KB1_SC_Y = 0x15,
  KB1_SC_U = 0x16,
  KB1_SC_I = 0x17,
  KB1_SC_O = 0x18,
  KB1_SC_P = 0x19,
  KB1_SC_LEFT_BRACKET = 0x1A,
  KB1_SC_RIGHT_BRACKET = 0x1B,
  KB1_SC_ENTER = 0x1C,
  KB1_SC_LEFT_CTRL = 0x1D,
  KB1_SC_A = 0x1E,
  KB1_SC_S = 0x1F,
  KB1_SC_D = 0x20,
  KB1_SC_F = 0x21,
  KB1_SC_G = 0x22,
  KB1_SC_H = 0x23,
  KB1_SC_J = 0x24,
  KB1_SC_K = 0x25,
  KB1_SC_L = 0x26,
  KB1_SC_SEMICOLON = 0x27,
  KB1_SC_SINGLE_QUOTE = 0x28,
  KB1_SC_BACKTICK = 0x29,
  KB1_SC_LEFT_SHIFT = 0x2A,
  KB1_SC_BACKSLASH = 0x2B,
  KB1_SC_Z = 0x2C,
  KB1_SC_X = 0x2D,
  KB1_SC_C = 0x2E,
  KB1_SC_V = 0x2F,
  KB1_SC_B = 0x30,
  KB1_SC_N = 0x31,
  KB1_SC_M = 0x32,
  KB1_SC_COMMA = 0x33,
  KB1_SC_PERIOD = 0x34,
  KB1_SC_SLASH = 0x35,
  KB1_SC_RIGHT_SHIFT = 0x36,
  KB1_SC_PRINTSCREEN = 0x37,
  KB1_SC_LEFT_ALT = 0x38,
  KB1_SC_SPACE = 0x39,
  KB1_SC_CAPSLOCK = 0x3A,
  KB1_SC_F1 = 0x3B,
  KB1_SC_F2 = 0x3C,
  KB1_SC_F3 = 0x3D,
  KB1_SC_F4 = 0x3E,
  KB1_SC_F5 = 0x3F,
  KB1_SC_F6 = 0x40,
  KB1_SC_F7 = 0x41,
  KB1_SC_F8 = 0x42,
  KB1_SC_F9 = 0x43,
  KB1_SC_F10 = 0x44,
  KB1_SC_NUMLOCK = 0x45,
  KB1_SC_SCROLLLOCK = 0x46,
  KB1_SC_HOME = 0x47,
  KB1_SC_UP = 0x48,
  KB1_SC_PAGE_UP = 0x49,
  KB1_SC_NUMPAD_MINUS = 0x4A,
  KB1_SC_LEFT = 0x4B,
  KB1_SC_CENTER = 0x4C,
  KB1_SC_RIGHT = 0x4D,
  KB1_SC_NUMPAD_PLUS = 0x4E,
  KB1_SC_END = 0x4F,
  KB1_SC_DOWN = 0x50,
  KB1_SC_PAGE_DOWN = 0x51,
  KB1_SC_INSERT = 0x52,
  KB1_SC_DELETE = 0x53,
  KB1_SC_SYSREQ = 0x54,
  KB1_SC_F11 = 0x57,
  KB1_SC_F12 = 0x58,
  KB1_SC_PAUSE = 0x59
};

static unused u8 kb_scancodes_set1_noshift_map[] = {
  [KB1_SC_ESC] = 0x1B,
  [KB1_SC_1] = '1',
  [KB1_SC_2] = '2',
  [KB1_SC_3] = '3',
  [KB1_SC_4] = '4',
  [KB1_SC_5] = '5',
  [KB1_SC_6] = '6',
  [KB1_SC_7] = '7',
  [KB1_SC_8] = '8',
  [KB1_SC_9] = '9',
  [KB1_SC_0] = '0',
  [KB1_SC_MINUS] = '-',
  [KB1_SC_EQUALS] = '=',
  [KB1_SC_BACKSPACE] = 0x08,
  [KB1_SC_TAB] = 0x09,
  [KB1_SC_Q] = 'q',
  [KB1_SC_W] = 'w',
  [KB1_SC_E] = 'e',
  [KB1_SC_R] = 'r',
  [KB1_SC_T] = 't',
  [KB1_SC_Y] = 'y',
  [KB1_SC_U] = 'u',
  [KB1_SC_I] = 'i',
  [KB1_SC_O] = 'o',
  [KB1_SC_P] = 'p',
  [KB1_SC_LEFT_BRACKET] = '[',
  [KB1_SC_RIGHT_BRACKET] = ']',
  [KB1_SC_ENTER] = 0x0D,
  [KB1_SC_LEFT_CTRL] = 0x00,
  [KB1_SC_A] = 'a',
  [KB1_SC_S] = 's',
  [KB1_SC_D] = 'd',
  [KB1_SC_F] = 'f',
  [KB1_SC_G] = 'g',
  [KB1_SC_H] = 'h',
  [KB1_SC_J] = 'j',
  [KB1_SC_K] = 'k',
  [KB1_SC_L] = 'l',
  [KB1_SC_SEMICOLON] = ';',
  [KB1_SC_SINGLE_QUOTE] = '\'',
  [KB1_SC_BACKTICK] = '`',
  [KB1_SC_LEFT_SHIFT] = 0x00,
  [KB1_SC_BACKSLASH] = '\\',
  [KB1_SC_Z] = 'z',
  [KB1_SC_X] = 'x',
  [KB1_SC_C] = 'c',
  [KB1_SC_V] = 'v',
  [KB1_SC_B] = 'b',
  [KB1_SC_N] = 'n',
  [KB1_SC_M] = 'm',
  [KB1_SC_COMMA] = ',',
  [KB1_SC_PERIOD] = '.',
  [KB1_SC_SLASH] = '/',
  [KB1_SC_RIGHT_SHIFT] = 0x00,
  [KB1_SC_PRINTSCREEN] = 0x00,
  [KB1_SC_LEFT_ALT] = 0x00,
  [KB1_SC_SPACE] = ' ',
  [KB1_SC_CAPSLOCK] = 0x00,
  [KB1_SC_F1] = 0x00,
  [KB1_SC_F2] = 0x00,
  [KB1_SC_F3] = 0x00,
  [KB1_SC_F4] = 0x00,
  [KB1_SC_F5] = 0x00,
  [KB1_SC_F6] = 0x00,
  [KB1_SC_F7] = 0x00,
  [KB1_SC_F8] = 0x00,
  [KB1_SC_F9] = 0x00,
  [KB1_SC_F10] = 0x00,
  [KB1_SC_NUMLOCK] = 0x00,
  [KB1_SC_SCROLLLOCK] = 0x00,
  [KB1_SC_HOME] = 0x00,
  [KB1_SC_UP] = 0x00,
  [KB1_SC_PAGE_UP] = 0x00,
  [KB1_SC_NUMPAD_MINUS] = 0x00,
  [KB1_SC_LEFT] = 0x00,
  [KB1_SC_CENTER] = 0x00,
  [KB1_SC_RIGHT] = 0x00,
  [KB1_SC_NUMPAD_PLUS] = 0x00,
  [KB1_SC_END] = 0x00,
  [KB1_SC_DOWN] = 0x00,
  [KB1_SC_PAGE_DOWN] = 0x00,
  [KB1_SC_INSERT] = 0x00,
  [KB1_SC_DELETE] = 0x00,
  [KB1_SC_SYSREQ] = 0x00,
  [KB1_SC_F11] = 0x00,
  [KB1_SC_F12] = 0x00,
  [KB1_SC_PAUSE] = 0x00
};

static unused u8 kb_scancodes_set1_shift_map[] = {
  [KB1_SC_ESC] = 0x1B,
  [KB1_SC_1] = '!',
  [KB1_SC_2] = '@',
  [KB1_SC_3] = '#',
  [KB1_SC_4] = '$',
  [KB1_SC_5] = '%',
  [KB1_SC_6] = '^',
  [KB1_SC_7] = '&',
  [KB1_SC_8] = '*',
  [KB1_SC_9] = '(',
  [KB1_SC_0] = ')',
  [KB1_SC_MINUS] = '_',
  [KB1_SC_EQUALS] = '+',
  [KB1_SC_BACKSPACE] = 0x08,
  [KB1_SC_TAB] = 0x09,
  [KB1_SC_Q] = 'Q',
  [KB1_SC_W] = 'W',
  [KB1_SC_E] = 'E',
  [KB1_SC_R] = 'R',
  [KB1_SC_T] = 'T',
  [KB1_SC_Y] = 'Y',
  [KB1_SC_U] = 'U',
  [KB1_SC_I] = 'I',
  [KB1_SC_O] = 'O',
  [KB1_SC_P] = 'P',
  [KB1_SC_LEFT_BRACKET] = '{',
  [KB1_SC_RIGHT_BRACKET] = '}',
  [KB1_SC_ENTER] = 0x0D,
  [KB1_SC_LEFT_CTRL] = 0x00,
  [KB1_SC_A] = 'A',
  [KB1_SC_S] = 'S',
  [KB1_SC_D] = 'D',
  [KB1_SC_F] = 'F',
  [KB1_SC_G] = 'G',
  [KB1_SC_H] = 'H',
  [KB1_SC_J] = 'J',
  [KB1_SC_K] = 'K',
  [KB1_SC_L] = 'L',
  [KB1_SC_SEMICOLON] = ':',
  [KB1_SC_SINGLE_QUOTE] = '"',
  [KB1_SC_BACKTICK] = '~',
  [KB1_SC_LEFT_SHIFT] = 0x00,
  [KB1_SC_BACKSLASH] = '|',
  [KB1_SC_Z] = 'Z',
  [KB1_SC_X] = 'X',
  [KB1_SC_C] = 'C',
  [KB1_SC_V] = 'V',
  [KB1_SC_B] = 'B',
  [KB1_SC_N] = 'N',
  [KB1_SC_M] = 'M',
  [KB1_SC_COMMA] = '<',
  [KB1_SC_PERIOD] = '>',
  [KB1_SC_SLASH] = '?',
  [KB1_SC_RIGHT_SHIFT] = 0x00,
  [KB1_SC_PRINTSCREEN] = 0x00,
  [KB1_SC_LEFT_ALT] = 0x00,
  [KB1_SC_SPACE] = ' ',
  [KB1_SC_CAPSLOCK] = 0x00,
  [KB1_SC_F1] = 0x00,
  [KB1_SC_F2] = 0x00,
  [KB1_SC_F3] = 0x00,
  [KB1_SC_F4] = 0x00,
  [KB1_SC_F5] = 0x00,
  [KB1_SC_F6] = 0x00,
  [KB1_SC_F7] = 0x00,
  [KB1_SC_F8] = 0x00,
  [KB1_SC_F9] = 0x00,
  [KB1_SC_F10] = 0x00,
  [KB1_SC_NUMLOCK] = 0x00,
  [KB1_SC_SCROLLLOCK] = 0x00,
  [KB1_SC_HOME] = 0x00,
  [KB1_SC_UP] = 0x00,
  [KB1_SC_PAGE_UP] = 0x00,
  [KB1_SC_NUMPAD_MINUS] = 0x00,
  [KB1_SC_LEFT] = 0x00,
  [KB1_SC_CENTER] = 0x00,
  [KB1_SC_RIGHT] = 0x00,
  [KB1_SC_NUMPAD_PLUS] = 0x00,
  [KB1_SC_END] =0x00,
  [KB1_SC_DOWN] = 0x00,
  [KB1_SC_PAGE_DOWN] = 0x00,
  [KB1_SC_INSERT] = 0x00,
  [KB1_SC_DELETE] = 0x00,
  [KB1_SC_SYSREQ] = 0x00,
  [KB1_SC_F11] = 0x00,
  [KB1_SC_F12] = 0x00,
  [KB1_SC_PAUSE] = 0x00
};

bool keyboard_init();
bool keyboard_available();
u8 keyboard_get_scancode();
u8 keyboard_pop_scancode();
u8 keyboard_map(u8 scancode);
u8 keyboard_shift_flags();
u8 keyboard_extended_flags();

#endif
